{{- if and .Values.ingress.enabled .Values.gcp.monitoring.enabled }}
apiVersion: monitoring.cnrm.cloud.google.com/v1beta1
kind: MonitoringUptimeCheckConfig
metadata:
  name: {{ include "service.fullname" . }}-uptime
  annotations:
    cnrm.cloud.google.com/project-id: {{ .Values.gcp.projectId }}
spec:
  displayName: "{{ include "service.fullname" . }} Uptime Check"
  projectRef:
    external: {{ .Values.gcp.projectId }}
  monitoredResource:
    type: uptime_url
    filterLabels:
      host: {{ .Values.ingress.hostname | quote }}
      project_id: {{ .Values.gcp.projectId | quote }}
  httpCheck:
    path: "/health"
    requestMethod: GET
    useSsl: false
  selectedRegions:
    - EUROPE
  period: 60s
  timeout: 10s
  isInternal: false
{{- end }}
